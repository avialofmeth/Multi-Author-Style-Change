In Iran, the state sanctions gender assignment because the Quran forbids homosexuality, but does not forbid gender reassignment. This a bit of a simplification, but basically the Shia school which dominates Iran believe that anything not forbidden in the Quran is permissible by default. So to 'solve' the problem of homosexuality, one of the partners must become a woman. It's not so much about transgender rights, because this means that cisgender men who have no interest in transitioning must also undergo sex reassignment or risk the penalty of death.